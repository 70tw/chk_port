CLEAR
CLEAR ALL
CLOSE DATABASES ALL
CLEAR PROGRAM

=INSTALL_MSWINSCK()	&& w杆 WINSOCK 1000613C

*!*	OWINSOCK   =   CREATEOBJECT("MSWINSOCK.WINSOCK")   
*!*	IF   TYPE("OWINSOCK")   #   "O"  
*!*		MESSAGEBOX("WINSOCKJゼ飑lて",16,"t参T")  
*!*		RETURN
*!*	ENDIF  
*!*	IF NOT (OWINSOCK.LOCALIP == "127.0.0.1" OR EMPTY(OWINSOCK.LOCALIP))
*!*		WAIT WINDOW "呼隔dw钡q"+CHR(13)+[IP = ]+ALLTRIM(OWINSOCK.LOCALIP)
*!*	ENDIF

?CHK_PORT([www.google.com.tw],80)

CLEAR ALL
CLOSE DATABASES ALL
CLEAR PROGRAM


*********************
FUNCTION CHK_PORT
*********************
PARAMETERS P_cIP,P_nPORT
* \唷G代刚 PORT Τq_
* 把计P_IP rじA环狠D诀IP
* 把计P_PORT 计rAPORT NUMBER
LOCAL P_FLG,I,LNLAST
*!*	#DEFINE sckClosed	 0 
*!*	#DEFINE sckOpen	 1 
*!*	#DEFINE sckListening	 2 
*!*	#DEFINE sckConnectionPending	3 
*!*	#DEFINE sckResolvingHost	 4 
*!*	#DEFINE sckHostResolved	 5 
*!*	#DEFINE sckConnecting	 6 
*!*	#DEFINE sckConnected	 7 
*!*	#DEFINE sckClosing	 8 
*!*	#DEFINE sckError	 9 
	P_FLG=.F.
	IF TYPE('GETOBJECT("","MSWINSOCK.WINSOCK")') <> "O"
		RETURN .T.	&&1000609C
	ENDIF
	OWINSOCK = CREATEOBJECT("MSWINSOCK.WINSOCK")
	IF TYPE("OWINSOCK") # "O"  
		MESSAGEBOX("WINSOCK飑lてア毖",16,"t参T")  
		RETURN .F.
	ENDIF
	WITH OWINSOCK
		.REMOTEHOST = P_cIP
		.REMOTEPORT= P_nPORT
		.CONNECT()
		I=0
		LNLAST=-1
		DO WHILE .T.
			I=I+1
			IF LNLAST <> .STATE 
				LNLAST = .STATE 
			ELSE
				INKEY(.1)	 && Delay 1/10 second
			ENDIF
			IF LNLAST>=7 OR I>10
				IF LNLAST=7
					P_FLG=.T.
				ENDIF
				EXIT
			ENDIF
		ENDDO
		.CLOSE()
	ENDWITH
	RELEASE OWINSOCK
	RETURN P_FLG
ENDFUNC

*******************************
FUNCTION INSTALL_MSWINSCK
*******************************
LOCAL _OCXFILE,_REGFILE,_SYSTEM32_PATH
	_OCXFILE=[MSWINSCK.OCX]
	IF NOT FILE(_OCXFILE)
		RETURN
	ENDIF
	_REGFILE=[MSWINSCK.REG]
	IF NOT FILE(_REGFILE)
		RETURN
	ENDIF
	IF TYPE('GETOBJECT("","MSWINSOCK.WINSOCK")') <> "O"
		_SYSTEM32_PATH=LOWER(GETENV("WINDIR")+[\system32\])
		IF NOT FILE(_SYSTEM32_PATH+_OCXFILE)
			IF NOT DIRECTORY(_SYSTEM32_PATH)
				MD (_SYSTEM32_PATH)
			ENDIF
			COPY FILE (_OCXFILE) TO (_SYSTEM32_PATH+_OCXFILE)
		ENDIF
		IF FILE(_SYSTEM32_PATH+_OCXFILE)
			ShellExecute(0,"open","Regsvr32.exe",[ /s ]+_SYSTEM32_PATH+_OCXFILE,"",0)
			ShellExecute(0,"open","regedit","/s "+MENU_DIR+_REGFILE,"",0)	&&sWn魁郎
		ENDIF
	ENDIF
ENDFUNC